# 基本
Botを作るうえでの基本的なコードを学びましょう。<br>ここの知識で最低限のBotを作成することができます。

## 土台
まずは、何もしないからのコードを書きましょう
```py
import discord

client = discord.Client()

client.run("")
```
これは、前回の1番で紹介したコードです。
このコードに付け足していきます。

## イベント受信
Clientでは、イベントの受信をしてそれを処理することができます。<br>
ここでは基本的なイベント2つと、その受信方法を紹介します。

### on_ready()
on_readyのイベントは、Botがログインされたときに実行されるイベントです。

### on_message()
on_messageイベントは、誰かがメッセージを送信したときに実行されるイベントです。<br>
関数の引数には、メッセージの情報が格納されます。<br>
例: on_message(引数) = 「引数」にメッセージの情報がすべて格納される

### コード
イベントは
```py
@client.event
```
の次に
```py
async def ここ:
```
へ書きます。<br>
例えば...on_readyイベントを使う場合は
```py
@client.event
async def on_ready():
```
となります。<br>
これは、client変数にdiscord.Client()インスタンスを指定した後に書きます。<br>
そのため最終的なコードは
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  # 処理
  
client.run("")
```
となります。<br>
では、ログインするときにprintする文です。<br>
コードは以下となります。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")
  
client.run("")
```
Botにログインしたら、on_ready関数が実行されてprintされます。<br>
(printの引数に「Logged In」を指定しているため「Logged In」と出力されます)

## 基本
では、メッセージの受信もしてみましょう。<br>
追加のイベントは、前のイベントのさらに下に書きます。
```py
@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  # 処理
```
ということになります。<br>
このon_messageイベントの関数の引数には、messageが定義されています。<br>
この第1引数にはメッセージの情報が格納されます。<br>
例: ID / Content / Bot<br><br>
では、メッセージをオウム返しするコードを書いてみましょう。<br>
ただ、その前に、必ず入れなければいけないコードがあります。
```py
if message.author.bot:
  return
```
このコードです。<br>
このコードを入れないと、Bot自体がBot自体のワードに反応してループするということが起きます。<br>
なので、Botには反応しないようにします。<br>
ここで出てきている
```
message.author.bot
```
は...メッセージを送信したユーザーがBotか...ということです。<br>
BotだとTrueを返します。
```
return
```
は...関数の返り値を定義する...ということです。<br>
message.author.botでbotか判断し、returnで無視しています。<br>
(それ以降の処理を行わないようにしている)<br>
では、おうむ返しのコードを作っていきましょう。<br>
まず、現在のコードです。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
    
client.run("")
```
if分のbot判別用コードのみあります。<br>
その下にコードを付け足していきます。<br>
メッセージの内容は
```
message.content
```
で取得することができます。<br>
次に、メッセージが送られたチャンネルを取得する必要があります。<br>
同じチャンネルでメッセージを返すためです。<br>
チャンネルの取得は
```
message.channel
```
となります。<br>
そして、メッセージの送信はsend関数でできます。<br>
send関数は第1引数に内容を指定することができます。<br>
つまり全体のコードは
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  await message.channel.send(message.content)
    
client.run("")
```
になります。<br>
(awaitは、非同期処理に関連する話で、気になる場合は<a href="https://docs.python.org/ja/3/library/asyncio.html">こちら</a>で確認できます)<br>
message.channelでチャンネルを取得して、send関数でメッセージを送っています。<br>
(ちなみに、事前にidでチャンネルを指定して、変数定義して、その変数をsend関数に使うとidのチャンネルにメッセージを送信することもできます。)<br>
そして、第1引数にmessage.contentを指定しているためメッセージの内容をそのまま取得して、送信されることがわかります。

## 返信
おうむ返しはできました。<br>
次は、コマンドを実装してみましょう。<br>
message.contentをif分で比較後、処理を書けばできます。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  await message.channel.send(message.content)
    
client.run("")
```
現在のコードはこれです。<br>
一度おうむ返しのコードを消します。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
    
client.run("")
```
そして、if文でmessage.contentの内容を比較します。
```py
if message.content == "!test"
```
このif文で、比較ができます。<br>
「==」で「○○だったら」ということができます。<br>
あとはif文内に処理をコマンド実行時の処理に変えるだけです。<br>
試しに、「!test」で「テスト」と返事するコードを作ってみます。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if message.content == "!test":
    await message.channel.send("テスト")
    
client.run("")
```
if文で比較後、send関数でメッセージを送信してあげれば実装できます。<br>
違う点は、第1引数を自分で指定していること。<br>
そして、if文を使っていることです。<br>
これで、実装は完了です。

### 量産
量産してみましょう。<br>
@client.eventを増やしてはいけません。<br>
同じ関数内にif文を作りましょう。<br>
現在のコードは
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if message.content == "!test":
    await message.channel.send("テスト")
    
client.run("")
```
です。<br>
この`if message.content == "!test":`のif文の下にさらに`elif`文を使ってコードを書きます。<br>
if = もし○○なら...<br>
elif = でなく、○○であれば...<br>
となります。<br>
試しに`!mynameis`と打ったら実行者の名前が返ってくる文を書いてみましょう。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if message.content == "!test": # もし○○なら
    await message.channel.send("テスト")
  elif message.content == "!mynameis": # そうじゃなく、○○だったら
    await message.channel.send(message.author.name)
    
client.run("")
```
となります。<br>
message.author.nameは、実行者の名前を表示するものです。<br>
message.author = 実行者の情報を取得<br>
name = 実行者の名前を取得<br>
です。<br>
あとはこれを量産して、if文とsend関数を変えればいいだけです。

### エラー
コマンドが存在しないときのエラーもつけることができます。<br>
elif文を量産して、一番下のelifにさらにelseを付け足します。<br>
elseは`もし当てはまらなかったら`という処理です。<br>
つまり、ifやelifの内容が当てはまらなければelseの内容が実行されます。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if message.content == "!test": # もし○○なら
    await message.channel.send("テスト")
  elif message.content == "!mynameis": # そうじゃなく、○○だったら
    await message.channel.send(message.author.name)
    
client.run("")
```
現在のコードがこれです。<br>
一番したのelifにさらにelseを付け足してみます。<br>
そして、「コマンドが存在しません」と表示させてみます。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if message.content == "!test": # もし○○なら
    await message.channel.send("テスト")
  elif message.content == "!mynameis": # そうじゃなく、○○だったら
    await message.channel.send(message.author.name)
  else: # もしifまたはelifに当てはまらなかったら
    await message.channel.send("コマンドが存在しません")
    
client.run("")
```
このようなコードになります。<br>
ただ、これだとPrefixが無くても送信されてしまいます。<br>
Prefixが「!」でかつコマンドが存在しない場合に送信するようにしましょう。<br>
そういう時は、elseの中にifを入れましょう。<br>
(基本的にifの中にさらにifを入れるのはあまりよろしくないです)<br>
elseの中を
```py
if message.content.startswith("!"):
  await message.channel.send("コマンドが存在しません")
```
に変えます。<br>
こうすることで、最初の文字が「!」である場合にのみコードが実行されます。<br>
なので、すべてのコードは結果的に
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if message.content == "!test": # もし○○なら
    await message.channel.send("テスト")
  elif message.content == "!mynameis": # そうじゃなく、○○だったら
    await message.channel.send(message.author.name)
  else: # もしifまたはelifに当てはまらなかったら
    if message.content.startswith("!"): # もし最初が「!」であれば
      await message.channel.send("コマンドが存在しません")
    
client.run("")
```
となります。

### startswith関数
startswith関数は、文字の最初が○○だったら、と言うif文を簡単に作ることができます。<br>
もし当てはまっていたらTrue、そうでなければFalseを返します。

# 動作
動作させてみましょう。<br>
前回と同じように、コマンドで実行しましょう。<br>
もし「!test」とうち「テスト」と帰ってきたら正常動作です。<br>
そして「!mynameis」と打って自分の名前が帰ってきたら正常です。<br>
Prefixを「!」として存在しないコマンドを打って「コマンドが存在しません」と帰ってきたら正常です。
