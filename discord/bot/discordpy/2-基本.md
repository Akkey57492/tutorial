# 基本
Botを作るうえでの基本的なコードを学びましょう。<br>ここの知識で最低限のBotを作成することができます。

## 土台
まずは、何もしないからのコードを書きましょう
```py
import discord

client = discord.Client()

client.run("")
```
これは、前回の1番で紹介したコードです。
このコードに付け足していきます。

## イベント受信
Clientでは、イベントの受信をしてそれを処理することができます。<br>
ここでは基本的なイベント2つと、その受信方法を紹介します。

### on_ready()
on_readyのイベントは、Botがログインされたときに実行されるイベントです。

### on_message()
on_messageイベントは、誰かがメッセージを送信したときに実行されるイベントです。<br>
関数の引数には、メッセージの情報が格納されます。<br>
例: on_message(引数) = 「引数」にメッセージの情報がすべて格納される

### コード
イベントは
```py
@client.event
```
の次に
```py
async def ここ:
```
へ書きます。<br>
例えば...on_readyイベントを使う場合は
```py
@client.event
async def on_ready():
```
となります。<br>
これは、client変数にdiscord.Client()インスタンスを指定した後に書きます。<br>
そのため最終的なコードは
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  # 処理
  
client.run("")
```
となります。<br>
では、ログインするときにprintする文です。<br>
コードは以下となります。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")
  
client.run("")
```
Botにログインしたら、on_ready関数が実行されてprintされます。<br>
(printの引数に「Logged In」を指定しているため「Logged In」と出力されます)

## 基本
では、メッセージの受信もしてみましょう。<br>
追加のイベントは、前のイベントのさらに下に書きます。
```py
@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  # 処理
```
ということになります。<br>
このon_messageイベントの関数の引数には、messageが定義されています。<br>
この第1引数にはメッセージの情報が格納されます。<br>
例: ID / Content / Bot<br><br>
では、メッセージをオウム返しするコードを書いてみましょう。<br>
ただ、その前に、必ず入れなければいけないコードがあります。
```py
if message.author.bot:
  return
```
このコードです。<br>
このコードを入れないと、Bot自体がBot自体のワードに反応してループするということが起きます。<br>
なので、Botには反応しないようにします。<br>
ここで出てきている
```
message.author.bot
```
は...メッセージを送信したユーザーがBotか...ということです。<br>
BotだとTrueを返します。
```
return
```
は...関数の返り値を定義する...ということです。<br>
message.author.botでbotか判断し、returnで無視しています。<br>
(それ以降の処理を行わないようにしている)<br>
では、おうむ返しのコードを作っていきましょう。<br>
まず、現在のコードです。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
    
client.run("")
```
if分のbot判別用コードのみあります。<br>
その下にコードを付け足していきます。<br>
メッセージの内容は
```
message.content
```
で取得することができます。<br>
次に、メッセージが送られたチャンネルを取得する必要があります。<br>
同じチャンネルでメッセージを返すためです。<br>
チャンネルの取得は
```
message.channel
```
となります。<br>
そして、メッセージの送信はsend関数でできます。<br>
send関数は第1引数に内容を指定することができます。<br>
つまり全体のコードは
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  await message.channel.send(message.content)
    
client.run("")
```
になります。<br>
(awaitは、非同期処理に関連する話で、気になる場合は<a href="https://docs.python.org/ja/3/library/asyncio.html">こちら</a>で確認できます)<br>
message.channelでチャンネルを取得して、send関数でメッセージを送っています。<br>
(ちなみに、事前にidでチャンネルを指定して、変数定義して、その変数をsend関数に使うとidのチャンネルにメッセージを送信することもできます。)<br>
そして、第1引数にmessage.contentを指定しているためメッセージの内容をそのまま取得して、送信されることがわかります。

### 実行
動作させてみましょう。<br>
pyファイルはそのまま実行することもできます。<br>
ただ、エラーが出た時のためにコマンドプロンプトから起動することをお勧めします。<br>
1番で紹介した通りpyコマンド(またはpythonコマンド)で可能です。<br>
詳しくは1番をご確認ください。
Botが入っているサーバーで、メッセージを送っておうむ返しされたら成功です。

## 会話
ではしっかりした会話機能を作ってみましょう。<br>
これは、`message.content`の内容をif文で確かめるだけです。<br>
if文の「==」を使えば簡単に実装できます。<br>
if部分のコードは
```py
if message.content == "反応させたい内容":
  await message.channel.send("反応したい内容")
```
になります。<br>
例えば、ユーザーが「Hello」と送信したら「Hello!」と返事するようにするには...<br>
全体のコードが
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if message.content == "Hello":
    await message.channel.send("Hello!")
    
client.run("")
```
となります。

### 実行
上と同様にコマンドで実行させてみましょう。<br>
「Hello」と送信して「Hello!」と帰ってきたら成功です。<br>
ちなみに...メッセージに返信モードでする場合は...
```py
await message.reply("Hello!")
```
となります。

### inを使う
ただ、「==」を使った方法だと少し欠点があります。<br>
そのまま一致する文字列でなければならないことです。<br>
つまり、「==」だと「Hello」というメッセージには反応するが<br>
「Hello!」と言うメッセージには反応しないということです。<br>
これを解決するのが「in」です。<br>
「in」は、「一致する場合」ではなく「含まれている場合」です。<br>
例えば
```py
if "Hello" == "Heloo!":
  print("True")
```
これだと、Helloが「Hello!」と同じ文字列ではないのでFalseになります。
ただ
```py
if "Hello" in "Hello!":
  print("True")
```
これコードだと、Helloが「Hello!」の中に含まれていてTrueになります。<br>
「==」は一致しているかの確認、「in」は含まれているかの確認です。<br>
そして、基本的には「in」を使うことをお勧めします。<br>
上のコードを「in」に直すと
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if "Hello" in message.content:
    await message.channel.send("Hello!")
    
client.run("")
```
になります。<br>
上記のコードを実行して、「Hello!」等でも反応が返ってきたら成功です。
