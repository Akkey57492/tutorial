# コマンド
Client及びCommandsフレームワークでコマンドを実装してみましょう。<br>
最初はClientフレームワークでのやり方です。

# Client
## 基本
if文を使ったコマンド処理を書いてみましょう。<br>
まずは、on_readyとon_messageにauthor.botのifを用意したコードを準備します。
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
    
client.run("")
```
現在のコードはこれになります。<br>
まずは、最初の文字が指定の記号や文字列でなければ無視するifを作ります。<br>
startswithで、最初の記号や文字列が特定の文字列であるかを確認します。<br>
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if not message.content.startswith("!"):
    return
    
client.run("")
```
not文を使い、Prefixが「!」であればreturnしない、と言う処理を行いました。
### if not
if notを行うと、Trueになる内容がFalseになったり<br>
Falseになる内容がTrueになったりします。<br>
つまりFalseとTrueの結果が逆になります。

次に、引数を受け付けましょう。<br>
split文を使います。<br>
splitは、引数に指定した文字列で文字を区切ってリストにいれてくれます。<br>
例えば
```py
test = "abc bcb cdc"
test_split = test.split(" ")
```
とすると、test_splitに
```
["abc", "bcb", "cdc"]
```
が格納されます。<br>
これは、splitの引数に、空白を指定していて、空白ごとにリストに文字を入れているからです。<br>
これを使ったコードが
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if not message.content.startswith("!"):
    return
  args = message.content.split(" ")
    
client.run("")
```
です。<br>
では、コマンドを実装していきましょう。<br>
これは、if文を使うのですが少し構文が変わります。<br>
今回リストのIndex番号0にコマンド、1以降に引数が収納されています。<br>
つまりコマンドのif文は
```py
if args[0] == "!ping":
  await message.channel.send("Pong")
```
となります。<br>
リストの内容の取得については<a href="https://www.javadrive.jp/python/list/index2.html">こちら</a>をご確認ください。<br>
pingコマンドを実行するには...
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if not message.content.startswith("!"):
    return
  args = message.content.split(" ")
  if args[0] == "!ping":
    await message.channel.send("Pong")
    
client.run("")
```
となるわけです。<br>
これを実行して、「!ping」と送信して「Pong」と帰ってきたら成功です。<br>
実行は、コマンドプロンプトを使って行うことを推奨します。<br>
そうすると、エラーが出ても一瞬でプログラムが落ちることが無くなります。<br>
正確には、プログラムが終わってもコンソールが閉じてしまわないのでエラーがしっかり見れるということです。

## 引数
では引数も対応させてみましょう。<br>
次は、sayコマンドを作ってみます。<br>
split文では、指定した文を区切りとしてリストに文字を格納していきます。<br>
つまり、リストから要素を取得するのと同じと言うことです。<br>
Index番号0にはコマンドが格納されていて、1番以降には引数の内容が格納されています。<br>
そのため全体のコードは
```
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if not message.content.startswith("!"):
    return
  args = message.content.split(" ")
  if args[0] == "!ping":
    await message.channel.send("Pong")
  elif args[0] == "!say":
    await message.channel.send(args[1])
    
client.run("")
```
となります。<br>
ここで、elifが出てきます。<br>
elifは「もしそうでなく...こうであれば」と言う意味です。<br>
そして、引数ですが上でも書いたように1番は引数の内容が格納されます。<br>
そのため、Index番号に1を指定すれば内容が取得できます。<br>
これを実行して、sayを実行して引数の内容が返されたら成功です。<br>
ただ...例外処理をしていないとエラーが出てしまいます。<br>
引数を入力してなかったときのエラーを追加しましょう。<br>
send関数をtry文で囲みます。
```py
try:
  await message.channel.send(args[1])
```
そして、exceptで「IndexError」を指定します。
```py
try:
  await message.channel.send(args[1])
except IndexError:
```
あとはexceptの後にエラーを出力すればOKです。
```py
try:
  await message.channel.send(args[1])
except IndexError:
  await message.channel.send("引数が足りません。")
```
このtryは、指定したエラーが発生したときexceptの内容を実行するというものです。<br>
このtry文では、「IndexError」が発生したとき「引数が足りません」と送信する<br>
となります。<br>
そして全体のコードは
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if not message.content.startswith("!"):
    return
  args = message.content.split(" ")
  if args[0] == "!ping":
    await message.channel.send("Pong")
  elif args[0] == "!say":
    try:
      await message.channel.send(args[1])
    except IndexError:
      await message.channel.send("引数が足りません。")
    
client.run("")
```
となります。<br>
これを実行して、引数をあえて入力しても内部エラーが出なければ成功です。<br>
(内部エラー: コンソールに出る例外処理されていないエラー)<br>

## 存在しないコマンド
最後に存在しないコマンドのエラーを追加しましょう。<br>
else文をif及びelifの下に付け加えます。<br>
elseは「どれにも当てはまらなければ」になります。<br>
今回は「コマンドが存在しません」と送信させます。<br>
使い方はif及びelifと同じでelseの中に動作を書くだけです。<br>
ただ、elseは「当てはまらない場合は」なので条件式はいりません。<br>
つまり
```py
  if args[0] == "!ping":
    await message.channel.send("Pong")
  elif args[0] == "!say":
    try:
      await message.channel.send(args[1])
    except IndexError:
      await message.channel.send("引数が足りません。")
  else:
    await message.channel.send("コマンドが存在しません")
```
となるわけです。<br>
そして全体のコードは
```py
import discord

client = discord.Client()

@client.event
async def on_ready():
  print("Logged In")

@client.event
async def on_message(message):
  if message.author.bot:
    return
  if not message.content.startswith("!"):
    return
  args = message.content.split(" ")
  if args[0] == "!ping":
    await message.channel.send("Pong")
  elif args[0] == "!say":
    try:
      await message.channel.send(args[1])
    except IndexError:
      await message.channel.send("引数が足りません。")
  else:
    await message.channel.send("コマンドが存在しません")
    
client.run("")
```
となります。<br>
これを実行して、Prefixを「!」にして適当にメッセージを送信してみてください。<br>
そして、適当なメッセージも送信してみてください。<br>
Prefixが「!」の場合はエラーがでて、適当なメッセージの場合はエラーが出ないはずです。<br>
正常に動いたら成功です。

# Commandsフレームワーク
現在準備中
